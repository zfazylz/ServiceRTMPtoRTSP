# Конвертер RTMP в RTSP

Веб-приложение для конвертации RTMP-потоков в RTSP-потоки с использованием FastAPI и FFmpeg.

## Возможности

- Конвертация RTMP-потоков в RTSP-потоки
- Веб-интерфейс для управления потоками
- Добавление, просмотр и удаление потоков
- RESTful API для программного доступа
- Контейнеризация с Docker для простого развертывания
- База данных SQLite для хранения информации о потоках
- Автоматическая реинициализация потоков при перезапуске приложения

## Требования

- Docker и Docker Compose
- FFmpeg (устанавливается автоматически в Docker)
- Исходные RTMP-потоки

## Быстрый старт

1. Клонируйте этот репозиторий:
   ```bash
   git clone <repository-url>
   cd rtmp-to-rtsp-converter
   ```

2. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up -d
   ```

3. Откройте веб-интерфейс по адресу http://localhost:8000

## Использование

### Веб-интерфейс

Веб-интерфейс предоставляет три основные страницы:

1. **Главная страница**: Просмотр всех активных потоков с их деталями
2. **Страница добавления потока**: Добавление нового RTMP-потока для конвертации в RTSP
3. **Удаление потока**: Удаление потока из конвертера

### Добавление потока

Чтобы добавить новый поток:

1. Нажмите "Добавить новый поток" на главной странице
2. Введите URL RTMP (должен начинаться с `rtmp://`)
3. Введите уникальное имя для потока (пробелы не допускаются)
4. Укажите порт RTSP (по умолчанию: 8554)
5. Нажмите "Добавить поток"

### Доступ к RTSP-потокам

После добавления потока вы можете получить к нему доступ с помощью любого RTSP-совместимого плеера (например, VLC):

```
rtsp://localhost:ПОРТ/ИМЯ_ПОТОКА
```

Где:
- `ПОРТ` - указанный вами порт RTSP
- `ИМЯ_ПОТОКА` - имя, которое вы дали потоку

Пример:
```
rtsp://localhost:8554/my_stream
```

## Документация API

Приложение предоставляет RESTful API для программного доступа:

### Получить все потоки

```
GET /api/streams
```

### Получить конкретный поток

```
GET /api/streams/{stream_name}
```

### Добавить новый поток

```
POST /api/streams
```

Тело запроса:
```json
{
  "rtmp_url": "rtmp://example.com/live/stream",
  "stream_name": "my_stream",
  "rtsp_port": 8554
}
```

### Удалить поток

```
DELETE /api/streams/{stream_name}
```

## Сохранение потоков

Приложение использует SQLite для хранения информации о потоках, обеспечивая их сохранение даже при перезапуске приложения. При запуске приложение автоматически загружает все сохраненные потоки из базы данных и перезапускает их.

### Расположение базы данных

База данных SQLite хранится в директории `data` в корне проекта. В Docker эта директория монтируется как том для обеспечения сохранности данных при перезапуске контейнера.

## Устранение неполадок

### Проблемы с RTSP-потоками

Если у вас возникают проблемы с RTSP-потоками, попробуйте использовать режим сетевого хоста:

1. Отредактируйте `docker-compose.yml`
2. Раскомментируйте строку `network_mode: host`
3. Закомментируйте секцию `ports`
4. Перезапустите приложение:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

### Ошибки FFmpeg

Если вы видите ошибки FFmpeg в логах, проверьте:

1. URL RTMP корректен и доступен
2. RTMP-поток активен и работает
3. Порт RTSP не используется другим приложением

### Проблемы с базой данных

Если у вас возникают проблемы с сохранением потоков:

1. Проверьте, что директория `data` существует и доступна для записи
2. Убедитесь, что файл базы данных SQLite (`data/streams.db`) существует
3. Если используете Docker, убедитесь, что том правильно смонтирован

## Разработка

Для запуска приложения в режиме разработки:

1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Запустите приложение:
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

## Лицензия

Этот проект лицензирован под лицензией MIT - см. файл LICENSE для подробностей.
